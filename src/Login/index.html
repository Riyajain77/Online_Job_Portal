<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login form</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://kit.fontawesome.com/c9c1016c2a.js" crossorigin="anonymous"></script>

</head>

<body>
    <div class="container">
        <div class="formbox">
            <h1 id="title">Sign Up</h1>
            <form>
                <div class="input-group">
                    <div class="input-field" id="namefield">
                        <i class="fa-solid fa-user"></i>
                        <input type="text" placeholder="Enter your name">
                    </div>

                    <div class="input-field" id="email">
                        <i class="fa-solid fa-envelope"></i>
                        <input type="email" placeholder="Enter your Email">
                    </div>

                    <div class="input-field" id="password">
                        <i class="fa-solid fa-lock"></i>
                        <input type="password" placeholder="Enter your password">
                    </div>
                    <p><a href="#">Forgot password</a></p>
                </div>

                <div class="but-field">
                    <button type="button" id="signupbut">Sign Up</button>
                    <button type="button" id="loginbut" class="disable">Login</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let signupbut = document.getElementById("signupbut");
        let loginbut = document.getElementById("loginbut");
        let namefield = document.getElementById("namefield");
        let title = document.getElementById("title");

        loginbut.onclick = function () {
            namefield.style.maxHeight = "0";
            title.innerHTML = "Login";
            signupbut.classList.add("disable");
            loginbut.classList.remove("disable");
        }

        signupbut.onclick = function () {
            namefield.style.maxHeight = "60px";
            title.innerHTML = "Sign Up";
            signupbut.classList.remove("disable");
            loginbut.classList.add("disable");
        }
    </script>
</body>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAM_i8HHMv7vpK8Ts5i0ZA02M7XddUpb6Y",
            authDomain: "online-job-portal-23488.firebaseapp.com",
            projectId: "online-job-portal-23488",
            storageBucket: "online-job-portal-23488.appspot.com",
            messagingSenderId: "73051965079",
            appId: "1:73051965079:web:060f2ea0e67f782b160bd2"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth();

     let signupbut = document.getElementById("signupbut");
    signupbut.addEventListener('click',(e)=>{

        var name = document.getElementById('namefield').querySelector('input').value;
        var email = document.getElementById('email').querySelector('input').value;
        var password = document.getElementById('password').querySelector('input').value;

        createUserWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
                // Signed up 
                const user = userCredential.user;

                console.log('Name:', name);
                console.log('Email:', email);
                set(ref(database, 'users/' + user.uid), {
                    name: name,
                    email: email
                })

                alert('User signed up successfully!');
                
                // Redirect to the job portal page
                window.location.href = 'http://localhost:5173/';
                // ...
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;

                alert('errorMessage');
                // ..
            });

    });
     let loginbut = document.getElementById("loginbut");
     loginbut.addEventListener('click', (e) => {
         var email = document.getElementById('email').querySelector('input').value;
         var password = document.getElementById('password').querySelector('input').value;

         signInWithEmailAndPassword(auth, email, password)
             .then((userCredential) => {
                 // Signed in 
                 const user = userCredential.user;

                 const dt = new Date();
                 update(ref(database, 'users/' + user.uid), {
                     last_login: name,
                   
                 })
                 alert('User loged in successfully!');
                
                 // Redirect to the job portal page
                 window.location.href = 'http://localhost:5173/';
                 // ...
             })
             .catch((error) => {
                 const errorCode = error.code;
                 const errorMessage = error.message;
                 alert('errorMessage');
             });

     });

     const user = auth.currentUser;
     onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, see docs for a list of available properties
                // https://firebase.google.com/docs/reference/js/auth.user
                const uid = user.uid;
                // ...
            } else {
                // User is signed out
                // ...
            }
        });


    </script>
</html>

